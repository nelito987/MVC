@model WheelsShop.Models.ViewModels.CalculatorViewModel

@{
    ViewBag.Title = "Index";
}

<h2>Calculator</h2>

<div class="row calcInfo">
    <div class="col-md-12">
        <div class="col-md-2">
            @Html.Label("Width: ")
            @Html.DropDownListFor(model => model.Widths, Model.Widths, "---width---",
           new { @class = "form-control", placeholder = "", name="firstWidth", id="firstWidth",
               onchange = "Calculator(firstWidth, secondWidth, firstHeight, secondHeight, firstSize, secondSize)"
           })
        </div>
        <div class="col-md-2">
            @Html.Label("Height: ")
            @Html.DropDownListFor(model => model.Height, Model.Height, "---height---",
           new { @class = "form-control", placeholder = "Height", name = "firstHeight", id = "firstHeight",
               onchange = "Calculator(firstWidth, secondWidth, firstHeight, secondHeight, firstSize, secondSize)"
           })
        </div>
        <div class="col-md-2">
            @Html.Label("Size: ")
            @Html.DropDownListFor(model => model.Sizes, Model.Sizes, "---size---",
           new { @class = "form-control", placeholder = "Size", name = "firstSize", id = "firstSize" ,
               onchange = "Calculator(firstWidth, secondWidth, firstHeight, secondHeight, firstSize, secondSize)"
           })
        </div> 
        <div class="col-md-5 calcInfo">
            <p>Diameter of first tyre: <span id="calculatordiameter1"></span> </p>
        </div>
          
    </div>

    <div class="col-md-12">
        <div class="col-md-2">
            @Html.Label("Width: ")
            @Html.DropDownListFor(model => model.Widths, Model.Widths, "---width---",
           new { @class = "form-control", placeholder = "", name = "secondWidth", id = "secondWidth",
               onchange ="Calculator(firstWidth, secondWidth, firstHeight, secondHeight, firstSize, secondSize)" })
        </div>
        <div class="col-md-2">
            @Html.Label("Height: ")
            @Html.DropDownListFor(model => model.Height, Model.Height, "---height---",
           new { @class = "form-control", placeholder = "Height", name = "secondHeight", id = "secondHeight",
               onchange = "Calculator(firstWidth, secondWidth, firstHeight, secondHeight, firstSize, secondSize)"
           })
        </div>
        <div class="col-md-2">
            @Html.Label("Size: ")
            @Html.DropDownListFor(model => model.Sizes, Model.Sizes, "---size---",
           new { @class = "form-control", placeholder = "Size", name = "secondSize", id = "secondSize",
               onchange = "Calculator(firstWidth, secondWidth, firstHeight, secondHeight, firstSize, secondSize)"
           })
        </div>

        <div class="col-md-5 calcInfo">
            <p>Diameter of second tyre: <span id="calculatordiameter2"></span> </p>
        </div>
    </div>   
   
    <div class="col-md-11 calcInfo marginAdd">
        <div class="col-md-11">
            <p>Difference of diameters: <span id="calculatordifference"></span> </p>
        </div>
        <div class="col-md-11">
            <p>Difference in speedmeter if the vehhicle is driving with 100km/h: <span id="calculatorspeed"></span> </p>
        </div>
    </div>
    
</div>



@section scripts{
    <script>
        function Calculator(a1, a2, c1, c2, b1, b2) {
            var firstDiameter, secondDiameter, difference, diff1, diff2, sign, Percent, firstWidth, firstSize, firstHeight, secondWidth, secondSize, secondHeight;
            firstWidth = a1.value;
            secondWidth = a2.value;
            firstSize = b1.value;
            secondSize = b2.value;
            firstHeight = c1.value;
            secondHeight = c2.value;
            firstDiameter = firstSize * 25.4 + 2 * (firstHeight * (firstWidth / 100));
            secondDiameter = secondSize * 25.4 + 2 * (secondHeight * (secondWidth / 100));

            difference = (secondDiameter - firstDiameter);
            if (firstDiameter == null && firstDiameter == null) {
                diff1 = 0 + "mm";
                diff2 = 0 + "km";
            }
            else {
                if (difference > 0) {
                    sign = "+";
                }
                else {
                    sign = "";
                }
                diff1 = difference;
                Percent = (difference * 100) / firstDiameter;
                diff2 = (100 - Percent);
            }

            var diameter1 = '<!-- -->' + Math.round(firstDiameter) + ' мм';
            var diameter2 = '<!-- -->' + Math.round(secondDiameter) + ' мм';
            var difference = '';
            if (Math.round(diff1) == 0) {
                difference += '<!-- -->' + sign + String(Math.round(diff1)) + ' мм';
            }
            else if (Math.round(diff1) < -15 || Math.round(diff1) > 15) {
                difference += '<!-- --><span style="color:#B30000;">' + sign + String(Math.round(diff1)) + ' мм</span>&nbsp;&nbsp;<span style="font-weight:bold;color:#B30000;">(разликата е извън допустимите граници)</span>';
            }
            else {
                difference += '<!-- --><span style="color:#ffc266;">' + sign + String(Math.round(diff1)) + ' мм</span>&nbsp;&nbsp;<span style="font-weight:bold;color:#ffc266;">(разликата е в допустимите граници)</span>';
            }
            var speed = '<!-- --><br />' + Math.round(diff2) + ' км/ч';

            var div1 = document.getElementById('calculatordiameter1');
            if (div1) {
                div1.innerHTML = diameter1;
            }

            var div2 = document.getElementById('calculatordiameter2');
            if (div2) {
                div2.innerHTML = diameter2;
            }

            var div3 = document.getElementById('calculatordifference');
            if (div3) {
                div3.innerHTML = difference;
            }

            var div4 = document.getElementById('calculatorspeed');
            if (div4) {
                div4.innerHTML = speed;
            }
        }
    </script>
    }